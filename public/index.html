<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nulls Brawl Esport - Top 50 Ranking</title>
  <meta name="description" content="Classement officiel Null's Brawl Esport. D√©couvrez le Top 50 des meilleurs joueurs avec leur MMR et Tier.">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass-effect {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useMemo } = React;

// Configuration API
const API_BASE = window.location.hostname === 'localhost' 
  ? 'http://localhost:8888/.netlify/functions'
  : '/.netlify/functions';

const tierStyles = {
  S: 'bg-gradient-to-r from-yellow-400 via-yellow-300 to-yellow-200',
  A: 'bg-gradient-to-r from-blue-400 via-purple-300 to-indigo-200',
  B: 'bg-gradient-to-r from-orange-600 via-orange-400 to-orange-200',
  C: 'bg-gradient-to-r from-pink-600 via-red-500 to-red-400',
  D: 'bg-gradient-to-r from-blue-400 via-purple-400 to-purple-300',
  E: 'bg-gradient-to-r from-green-700 via-green-500 to-green-300',
  'No-tier': 'bg-gradient-to-r from-gray-600 via-gray-500 to-gray-400',
};

const getMedal = (rank) => {
  if (rank === 1) return 'ü•á';
  if (rank === 2) return 'ü•à';
  if (rank === 3) return 'ü•â';
  return `#${rank}`;
};

function DemonList() {
  const [players, setPlayers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [query, setQuery] = useState('');
  const [selectedTier, setSelectedTier] = useState('ALL');
  const [sortBy, setSortBy] = useState('rank');
  const [scrimsOpen, setScrimsOpen] = useState(true);

  const tiers = ['ALL','S','A','B','C','D','E','No-tier'];

  // Charger les joueurs depuis l'API
  useEffect(() => {
    fetchPlayers();
  }, []);

  const fetchPlayers = async () => {
    try {
      setLoading(true);
      setError(null);
      const response = await fetch(`${API_BASE}/getTop50`);
      const data = await response.json();
      
      if (data.ok) {
        // Ajouter le rang et formater les donn√©es
        const playersWithRank = data.top.map((p, index) => ({
          rank: index + 1,
          name: p.display_name,
          score: p.mmr,
          tier: p.tier || 'No-tier',
          gamesPlayed: p.games_played,
          wins: p.wins,
          losses: p.losses,
          id: p.id
        }));
        setPlayers(playersWithRank);
      } else {
        setError(data.error || 'Erreur lors du chargement');
      }
    } catch (err) {
      setError('Impossible de charger les donn√©es. V√©rifiez votre connexion.');
      console.error('Fetch error:', err);
    } finally {
      setLoading(false);
    }
  };

  const filteredPlayers = useMemo(() => {
    let list = [...players];
    if (selectedTier !== 'ALL') list = list.filter(p => p.tier === selectedTier);
    if (query.trim() !== '') list = list.filter(p => p.name.toLowerCase().includes(query.toLowerCase()));
    list.sort((a,b) => {
      if(sortBy === 'rank') return a.rank - b.rank;
      if(sortBy === 'score') return b.score - a.score;
      return a.name.localeCompare(b.name);
    });
    return list;
  }, [players, query, selectedTier, sortBy]);

  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black text-gray-100 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-16 w-16 border-t-4 border-indigo-500 mx-auto mb-4"></div>
          <p className="text-xl">Chargement du classement...</p>
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black text-gray-100 flex items-center justify-center p-6">
        <div className="glass-effect rounded-xl p-8 max-w-md text-center">
          <p className="text-red-400 text-xl mb-4">‚ùå {error}</p>
          <button onClick={fetchPlayers} className="px-6 py-3 bg-indigo-600 rounded-lg hover:bg-indigo-500 transition font-semibold">
            R√©essayer
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black text-gray-100 p-3 sm:p-6">
      
      {/* Header */}
      <header className="max-w-5xl mx-auto mb-6 sm:mb-8">
        <div className="text-center mb-4 sm:mb-6">
          <h1 className="text-3xl sm:text-5xl font-extrabold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500">
            Nulls Brawl Esport
          </h1>
          <p className="text-gray-400 text-base sm:text-lg">Top 50 Classement Officiel</p>
          <button onClick={fetchPlayers} className="mt-2 text-sm text-indigo-400 hover:text-indigo-300 underline">
            üîÑ Actualiser
          </button>
        </div>
        
        <div className="glass-effect rounded-xl p-3 sm:p-4 mb-4">
          <div className="flex gap-2 sm:gap-3 flex-wrap justify-center mb-3">
            <a href="https://discord.gg/prissme" target="_blank" rel="noopener noreferrer" className="px-3 sm:px-4 py-2 bg-indigo-600 rounded-lg hover:bg-indigo-500 transition font-semibold shadow-lg text-sm sm:text-base">
              Discord
            </a>
            <a href="https://ko-fi.com/prissme" target="_blank" rel="noopener noreferrer" className="px-3 sm:px-4 py-2 bg-yellow-500 rounded-lg hover:bg-yellow-400 transition font-semibold shadow-lg text-black text-sm sm:text-base">
              Coaching 9‚Ç¨
            </a>
          </div>

          <div className="flex flex-col sm:flex-row gap-2 sm:gap-3 mb-3">
            <input placeholder="Rechercher un joueur..." value={query} onChange={e => setQuery(e.target.value)} className="flex-1 px-3 sm:px-4 py-2 rounded-lg bg-gray-800/50 text-gray-100 border border-gray-700 focus:border-indigo-500 focus:outline-none text-sm sm:text-base" />
            <select value={sortBy} onChange={e => setSortBy(e.target.value)} className="px-3 sm:px-4 py-2 rounded-lg bg-gray-800/50 border border-gray-700 focus:border-indigo-500 text-sm sm:text-base">
              <option value="rank">Par Rang</option>
              <option value="score">Par Score</option>
              <option value="name">Par Pseudo</option>
            </select>
          </div>

          <div className="flex gap-2 flex-wrap justify-center">
            {tiers.map(t => (
              <button key={t} onClick={() => setSelectedTier(t)} className={`px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-bold transition-all duration-300 ${
                selectedTier === t
                  ? 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg scale-105' 
                  : 'bg-gray-800/50 text-gray-300 hover:bg-gray-700'
              }`}>
                {t}
              </button>
            ))}
          </div>
        </div>
      </header>

      {/* Stats globales */}
      <section className="max-w-5xl mx-auto mb-6 sm:mb-8">
        <div className="glass-effect rounded-xl p-4 sm:p-6 shadow-2xl">
          <h2 className="text-2xl sm:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-purple-400 mb-4">
            üìä Statistiques
          </h2>
          <div className="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4">
            <div className="bg-gray-800/50 p-3 sm:p-4 rounded-lg text-center">
              <p className="text-gray-400 text-sm">Joueurs actifs</p>
              <p className="text-2xl sm:text-3xl font-bold text-indigo-400">{players.length}</p>
            </div>
            <div className="bg-gray-800/50 p-3 sm:p-4 rounded-lg text-center">
              <p className="text-gray-400 text-sm">MMR moyen</p>
              <p className="text-2xl sm:text-3xl font-bold text-purple-400">
                {players.length > 0 ? Math.round(players.reduce((acc, p) => acc + p.score, 0) / players.length) : 0}
              </p>
            </div>
            <div className="bg-gray-800/50 p-3 sm:p-4 rounded-lg text-center">
              <p className="text-gray-400 text-sm">Top MMR</p>
              <p className="text-2xl sm:text-3xl font-bold text-yellow-400">
                {players.length > 0 ? Math.max(...players.map(p => p.score)) : 0}
              </p>
            </div>
            <div className="bg-gray-800/50 p-3 sm:p-4 rounded-lg text-center">
              <p className="text-gray-400 text-sm">Parties jou√©es</p>
              <p className="text-2xl sm:text-3xl font-bold text-green-400">
                {players.reduce((acc, p) => acc + (p.gamesPlayed || 0), 0)}
              </p>
            </div>
          </div>
        </div>
      </section>

      {/* Classement */}
      <main className="max-w-5xl mx-auto">
        {filteredPlayers.length === 0 ? (
          <div className="glass-effect rounded-xl p-8 text-center">
            <p className="text-xl text-gray-400">Aucun joueur trouv√© üîç</p>
          </div>
        ) : (
          <div className="grid gap-3 sm:gap-4">
            {filteredPlayers.map(player => {
              const tierClass = tierStyles[player.tier] || tierStyles['No-tier'];
              const winRate = player.gamesPlayed > 0 ? Math.round((player.wins / player.gamesPlayed) * 100) : 0;
              
              return (
                <div key={player.id} className={`${tierClass} p-3 sm:p-5 rounded-xl shadow-2xl text-gray-900 font-bold hover:scale-105 transition-transform`}>
                  <div className="flex items-center justify-between flex-wrap gap-2">
                    <div className="flex items-center gap-2 sm:gap-4">
                      <span className="text-xl sm:text-3xl font-bold min-w-[50px] sm:min-w-[70px]">{getMedal(player.rank)}</span>
                      <div>
                        <span className="text-lg sm:text-2xl block">{player.name}</span>
                        <span className="text-xs sm:text-sm opacity-75">
                          {player.gamesPlayed} matchs ‚Ä¢ {winRate}% WR
                        </span>
                      </div>
                    </div>
                    <div className="flex items-center gap-2 sm:gap-4">
                      <span className="text-base sm:text-xl">{player.score} pts</span>
                      <span className="px-3 sm:px-4 py-1.5 sm:py-2 bg-white bg-opacity-40 rounded-full text-xs sm:text-base whitespace-nowrap">
                        Tier {player.tier}
                      </span>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </main>

      {/* Footer */}
      <footer className="max-w-5xl mx-auto mt-8 sm:mt-12 text-center text-gray-400 text-xs sm:text-sm px-3">
        <p>¬© 2025 Null's Brawl Esport ‚Äì D√©velopp√© par <span className="text-indigo-400 font-bold">Prissme</span></p>
        <p className="mt-2 text-xs opacity-50">Donn√©es charg√©es en temps r√©el depuis Supabase</p>
      </footer>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<DemonList />);
</script>
</body>
</html>
